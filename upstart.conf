#!upstart
#
# Basic upstart script for running node.js apps as a service on ubuntu.
#
#
# If you have troubles use the command : initctl check-config
#
# To install
# sudo cp %APPLICATION%.conf /etc/init/%APPLICATION%.conf
# sudo chmod 777 /etc/init/%APPLICATION%.conf
#
 
description "%APPLICATION% server"
author      "@garrows"
 
start on (local-filesystems and net-device-up IFACE!=lo)
start on starting rc

respawn limit 5 10
respawn
 
script
    echo $$ > /var/run/%APPLICATION%.pid
 	cd %PATH%
 	export PORT=%NODEPORT%
    sudo -u node-user -g www-data forever >> /var/log/node/%APPLICATION%.log 2>&1
end script
 
pre-start script
    echo "[`date -u +%Y-%m-%dT%T.%3NZ`] (sys) Starting" >> /var/log/node/%APPLICATION%.log
end script
 
pre-stop script
    rm /var/run/%APPLICATION%.pid
    echo "[`date -u +%Y-%m-%dT%T.%3NZ`] (sys) Stopping" >> /var/log/node/%APPLICATION%.log
end script
